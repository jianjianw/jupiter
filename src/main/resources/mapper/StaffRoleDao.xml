<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qiein.jupiter.web.dao.StaffRoleDao">
    <resultMap id="baseMap" type="com.qiein.jupiter.web.entity.po.StaffRolePO">
        <result column="STAFFID" property="staffId" jdbcType="INTEGER"/>
        <result column="ROLEID" property="roleId" jdbcType="INTEGER"/>
        <result column="COMPANYID" property="companyId" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap id="staffPermissionMap" type="com.qiein.jupiter.web.entity.vo.StaffPermissionVO">
        <id column="ID" property="id" jdbcType="INTEGER"/>
        <result column="NICKNAME" property="nickName" jdbcType="VARCHAR"/>
        <result column="PHONE" property="phone" jdbcType="VARCHAR"/>
        <result column="USERNAME" property="userName" jdbcType="VARCHAR"/>
        <result column="PASSWORD" property="password" jdbcType="VARCHAR"/>
        <result column="COMPANYID" property="companyId" jdbcType="INTEGER"/>
        <result column="CORPID" property="corpId" jdbcType="VARCHAR"/>
        <result column="DINGUSERID" property="dingUserId" jdbcType="VARCHAR"/>
        <result column="OPENID" property="openId" jdbcType="VARCHAR"/>
        <result column="HEADIMG" property="headImg" jdbcType="VARCHAR"/>
        <result column="TOKEN" property="token" jdbcType="VARCHAR"/>
        <result column="ISSHOW" property="showFlag" jdbcType="INTEGER"/>
        <result column="ISLOCK" property="lockFlag" jdbcType="BOOLEAN"/>
        <result column="ISDEL" property="delFlag" jdbcType="BOOLEAN"/>
        <collection property="permissionList" ofType="com.qiein.jupiter.web.entity.po.PermissionPO" resultMap="permissionMap"/>
    </resultMap>

    <resultMap id="permissionMap" type="com.qiein.jupiter.web.entity.po.PermissionPO">
        <id column="PERMISSIONID" property="permissionId" jdbcType="INTEGER"/>
        <result column="PERMISSIONNAME" property="permissionName" jdbcType="VARCHAR"/>
        <result column="ABBREVIATE" property="abbreviate" jdbcType="VARCHAR"/>
        <result column="TYPEID" property="typeId" jdbcType="INTEGER"/>
    </resultMap>



    <sql id="baseColumn">
        STAFFID,ROLEID
    </sql>

    <!--批量添加员工多角色-->
    <insert id="batchInsertStaffRole" parameterType="map">
        INSERT INTO hm_pub_staff_role
        (STAFFID,ROLEID,COMPANYID)
        VALUES
        <foreach collection="roleIdArr" item="roleId" index="index" separator=",">
            (#{staffId},#{roleId},#{companyId})
        </foreach>
    </insert>

    <!--删除员工角色-->
    <delete id="deleteByStaffId" parameterType="map">
        DELETE FROM hm_pub_staff_role
        WHERE STAFFID = #{staffId}
        AND COMPANYID = #{companyId}
    </delete>

    <!--批量删除员工角色关联-->
    <delete id="batchDeleteByStaffIdArr" parameterType="map">
        DELETE FROM hm_pub_staff_role
        WHERE COMPANYID = #{companyId}
        AND STAFFID IN
        <foreach collection="staffIdArr" item="id" index="index" open="("
                 close=")" separator=",">
            #{id}
        </foreach>
    </delete>

    <!--批量添加多员工多角色-->
    <insert id="batchInsertStaffRoleByVO" parameterType="com.qiein.jupiter.web.entity.vo.StaffVO">
        INSERT INTO hm_pub_staff_role
        (STAFFID,ROLEID,COMPANYID)
        VALUES
        <foreach collection="list" item="vo" index="index" separator=",">
            (#{vo.id},#{vo.roleId},#{vo.companyId})
        </foreach>
    </insert>

    <!--获取员工权限信息-->
    <select id="getStaffPermission" resultMap="staffPermissionMap">
          SELECT
            staff.ID,
            staff.NICKNAME,
            staff.PHONE,
            staff.USERNAME,
            staff.COMPANYID,
            staff.CORPID,
            staff.DINGUSERID,
            staff.OPENID,
            staff.HEADIMG,
            staff.TOKEN,
            staff.ISSHOW,
            staff.ISLOCK,
            staff.ISDEL,
            permission.PERMISSIONNAME,
            permission.ID PERMISSIONID,
            permission.ABBREVIATE,
            permission.TYPEID
        FROM
            hm_pub_staff staff
            LEFT JOIN hm_pub_staff_role staff_role ON staff.ID = staff_role.STAFFID
            LEFT JOIN hm_pub_role_permission role_permission ON staff_role.ROLEID = role_permission.ROLEID
            LEFT JOIN hm_pub_permission permission ON role_permission.PERMISSIONID=permission.ID
        WHERE
            staff.ID = #{staffId}
            AND staff.COMPANYID = #{companyId}
    </select>
</mapper>