<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qiein.jupiter.web.dao.DictionaryDao">

    <resultMap id="baseMap" type="com.qiein.jupiter.web.entity.po.DictionaryPO">
        <id column="ID" jdbcType="INTEGER" property="id"/>
        <result column="DICTYPE" jdbcType="VARCHAR" property="dicType"/>
        <result column="DICCODE" jdbcType="VARCHAR" property="dicCode"/>
        <result column="DICNAME" jdbcType="INTEGER" property="dicName"/>
        <result column="PRIORITY" jdbcType="VARCHAR" property="priority"/>
        <result column="SPARE" jdbcType="INTEGER" property="spare"/>
        <result column="COMPANYID" jdbcType="INTEGER" property="companyId"/>
    </resultMap>

    <resultMap id="VOMap" type="com.qiein.jupiter.web.entity.vo.MenuVO">
        <result column="SPARE" jdbcType="VARCHAR" property="type"/>
        <result column="DICNAME" jdbcType="INTEGER" property="dicName"/>
    </resultMap>

    <sql id="baseColumn">
        ID,DICTYPE, DICCODE, DICNAME,PRIORITY, SPARE, COMPANYID
    </sql>

    <!--获取企业左上角菜单栏-->
    <select id="getCompanyMemu" parameterType="map" resultMap="VOMap">
        SELECT
            dic.DICNAME, dic.SPARE
        FROM
            hm_crm_dictionary dic
        WHERE
        dic.DICTYPE = #{dicType}
         AND  dic.COMPANYID = #{companyId}

    </select>

    <!--获取企业左上角菜单栏-->
    <select id="getDicByType" parameterType="map" resultMap="baseMap">
        SELECT
        <include refid="baseColumn"/>
        FROM
        hm_crm_dictionary dic
        WHERE
        dic.DICTYPE = #{dicType}
        AND dic.COMPANYID = #{companyId}
        ORDER BY dic.PRIORITY, dic.ID
    </select>

    <!--获取企业左上角菜单栏-->
    <select id="getDicByTypeAndName" parameterType="map" resultMap="baseMap">
        SELECT
        <include refid="baseColumn"/>
        FROM
        hm_crm_dictionary dic
        WHERE
        dic.DICTYPE = #{dicType}
        AND dic.COMPANYID = #{companyId}
        AND dic.DICNAME = #{dicName}
    </select>

    <!--新增字典数据-->
    <insert id="insert" parameterType="com.qiein.jupiter.web.entity.po.DictionaryPO">
        INSERT INTO hm_crm_dictionary
        (DICTYPE, DICCODE, DICNAME, PRIORITY, SPARE, COMPANYID)
        VALUES
        (#{dicType},#{dicCode},#{dicName},#{priority},#{spare},#{companyId})
    </insert>

    <!--编辑数据字典-->
    <update id="update" parameterType="com.qiein.jupiter.web.entity.po.DictionaryPO">
        UPDATE hm_crm_dictionary
        SET DICNAME = #{dicName}, SPARE = #{spare}
        WHERE
            COMPANYID = #{companyId}
        AND ID = #{id}
    </update>

    <!--批量删除字典数据-->
    <delete id="batchDeleteByIds" parameterType="map">
        DELETE FROM hm_crm_dictionary
        WHERE COMPANYID = #{companyId}
        AND ID IN
        <foreach collection="idArr" item="id" index="index" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>

    <!--获取企业所有字典数据-->
    <select id="getDictByCompanyId" resultMap="baseMap">
        SELECT
        <include refid="baseColumn"/>
        FROM
        hm_crm_dictionary dic
        WHERE
        dic.COMPANYID = #{companyId}
        ORDER BY dic.DICTYPE,dic.PRIORITY
    </select>

    <!--获取最大编码-->
    <select id="getMaxDicCode" parameterType="map" resultType="java.lang.Integer">
        SELECT
            IFNULL(MAX(dic.DICCODE),0)
        FROM
          hm_crm_dictionary dic
        WHERE
          dic.DICTYPE = #{dicType}
        AND dic.COMPANYID = #{companyId}
    </select>

    <!--新增字典记录-->
    <insert id="createDict" parameterType="dictionaryPO">
        INSERT INTO
	      hm_crm_dictionary
            (DICTYPE,DICCODE,DICNAME,PRIORITY,SPARE,COMPANYID)
        SELECT
          #{dicType},
	      (SELECT IFNULL(MAX(DICCODE),0)+1 FROM hm_crm_dictionary WHERE COMPANYID = 9292 AND DICTYPE = 'common_type'),
          #{dicName},
          (SELECT IFNULL(MAX(PRIORITY),0)+1 FROM hm_crm_dictionary WHERE COMPANYID = 9292 AND DICTYPE = 'common_type'),
          #{spare},#{companyId}
    </insert>

    <!--<update id="editDict" parameterType="dictionaryPO">
        UPDATE
          hm_crm_dictionary
        <set>
            <if test="">

            </if>
        </set>
    </update>-->

    <!--删除字典记录-->
    <delete id="delDict" parameterType="Integer">
        DELETE
        FROM
          hm_crm_dictionary
        WHERE
          ID = #{id} AND COMPANYID = #{companyId}
    </delete>

</mapper>