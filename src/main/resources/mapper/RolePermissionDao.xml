<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qiein.jupiter.web.dao.RolePermissionDao">
    <resultMap id="baseMap" type="com.qiein.jupiter.web.entity.po.RolePermissionPO">
        <result column="ROLEID" property="roleId" jdbcType="INTEGER"/>
        <result column="PERMISSIONID" property="permissionId" jdbcType="INTEGER"/>
        <result column="COMPANYID" property="companyId" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap id="VOMap" type="com.qiein.jupiter.web.entity.vo.RolePermissionVO">
        <result column="ID" property="roleId" jdbcType="INTEGER"/>
        <result column="ROLENAME" property="roleName" jdbcType="VARCHAR"/>
        <result column="COMPANYID" property="companyId" jdbcType="INTEGER"/>
        <collection property="pmsList" ofType="com.qiein.jupiter.web.entity.po.PermissionPO" resultMap="pmsPO"/>
    </resultMap>
    <resultMap id="pmsPO" type="com.qiein.jupiter.web.entity.po.PermissionPO">
        <result column="PMSID" property="permissionId" jdbcType="INTEGER"/>
        <result column="PERMISSIONNAME" property="permissionName" jdbcType="VARCHAR"/>
        <result column="TYPEID" property="typeId" jdbcType="INTEGER"/>
    </resultMap>

    <sql id="baseColumn">
        ROLEID,PERMISSIONID,COMPANYID
    </sql>

    <sql id="tableName">
       hm_pub_role_permission
    </sql>
    <!--获取当前公司下的所有角色及对应的权限-->
    <select id="getCompanyAllRole" parameterType="map" resultMap="VOMap">
        SELECT
          role.ID,role.ROLENAME,role.COMPANYID,pms.ID AS PMSID,pms.PERMISSIONNAME,pms.TYPEID
        FROM
          hm_pub_role role
        LEFT JOIN hm_pub_role_permission rela ON role.ID = rela.ROLEID AND role.COMPANYID = rela.COMPANYID
        LEFT JOIN hm_pub_permission pms ON rela.PERMISSIONID = pms.ID
        WHERE role.COMPANYID = #{companyId};
    </select>


</mapper>